  <!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> Disabling GKE load balancer in Kubernetes &middot; Maikel&#39;s Tech Blog </title>
    
    <link rel="stylesheet" type="text/css" href="http://www.maikel-hofman.nl/css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="http://www.maikel-hofman.nl/css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="Maikel&#39;s Tech Blog" />
    
    <script src="http://www.maikel-hofman.nl/js/jquery.min.js"></script>
    <script src="http://www.maikel-hofman.nl/js/main.min.js">
    </script>
</head>

  <body>
    <div id="scriptHeader">
    <span class="mobile btn-mobile-menu">
            <i class="fa fa-bars btn-mobile-menu__icon"></i>
            <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>
    <header class="
        
            panel-cover panel-cover--collapsed
        " >
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <h1 class="panel-cover__title panel-title">
                    <a href="http://www.maikel-hofman.nl/"  title="link to homepage for Maikel&#39;s Tech Blog">Maikel&#39;s Tech Blog</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description">  Blog about software and technology  </p>
                <hr class="panel-cover__divider panel-cover__divider--secondary" />
                <div class="navigation-wrapper">
                    <nav class="cover-navigation cover-navigation--primary">
                        <ul class="navigation">
                            <li class="navigation__item"><a href="http://www.maikel-hofman.nl#blog" title="link to Maikel&#39;s Tech Blog blog" class="blog-button">Blog</a> </li></br>
                            
                            
                       </ul>
                    </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/CarducciMH" title="@CarducciMH on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/MaikelH" title="MaikelH on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>    </ul>
</nav>
 </div>
            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
</div>
<noscript>
    <style>
        #scriptHeader {display:none;}
        .navigation-wrapper{
            display: block;
            top: 0;
        }
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url()">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="http://www.maikel-hofman.nl/"  title="link to homepage for Maikel&#39;s Tech Blog">Maikel&#39;s Tech Blog</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  Blog about software and technology  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                                <li class="navigation__item"><a href="http://www.maikel-hofman.nl/#blog" title="link to Maikel&#39;s Tech Blog blog" class="blog-button">Blog</a> </li></br>
                                
                                
                           </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/CarducciMH" title="@CarducciMH on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/MaikelH" title="MaikelH on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>    </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <div class="post">
          <h1>Disabling GKE load balancer in Kubernetes</h1>
          <span class="post-date">Mon, Aug 22, 2016</span>
          

<p>For a project we run a kubernetes cluster using the <a href="https://cloud.google.com/container-engine/">Google Container Engine (GKE)</a>. GKE provides a lot functionality out of the box including automatic configuration of load balancer using the kubernetes ingress resources. When you configure an ingress resource in kubernetes it will automatically create an GLCB load balancer with an external IP adress and route traffice into the cluster according the rules you set in the ingress resource.</p>

<p>Now the problem in our system is that we use traefik as a load balancer inside our cluster to manage incoming HTTP traffic and don&rsquo;t want to use the built in GCE load balancer. Traefik is then configured using the ingress resources. Doing it like this will lead to two load balancers in the system, the Google load balancer and the traefik one. To disable this behaviour there are 2 solutions.</p>

<h3 id="solution-1-annotate-ingress-resources">Solution 1: Annotate ingress resources</h3>

<p>It is possible to add the <code>kubernetes.io/ingress.class</code> annotation to specify which class load balancers should apply the rule. See the example below.</p>

<pre><code>apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: test-deployment
  annotations:
    kubernetes.io/ingress.class: &quot;nginx&quot;
spec:
  rules:
  - host: www.test.com
    http:
      paths:
      - backend:
          serviceName: wwww-service
          servicePort: 80
</code></pre>

<p>The above example will only create load balancer if the nginx addon is enabled. In our case this solution did not work and had to resort to solution 2 described below.</p>

<h3 id="solution-2-disable-httploadbalancer-addon-in-gke">Solution 2: Disable Httploadbalancer addon in GKE</h3>

<p>The second solution is to disable the load balancer addon in kubernetes. You can update a running cluster by using the following command. Beware that this will restart the master server.</p>

<pre><code>gcloud container clusters update NAME HttpLoadBalancing=ENABLED|DISABLED
</code></pre>

<p>When creating the cluster it also possible to immediately disable the HttpLoadBalancing by using the <code>--disable-addons</code> flag as follows:</p>

<pre><code>gcloud container clusters create NAME --disable-addons HttpLoadBalancing
</code></pre>

<h3 id="references">References</h3>

<ul>
<li><a href="https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/cluster-loadbalancing/glbc">More information about GLBC loadbalancer (GCE)</a></li>
<li><a href="https://cloud.google.com/sdk/gcloud/reference/container/clusters/create">Gcloud API for creating clusters</a></li>
</ul>

        </div>
        <div class="sharing">
<a href="https://twitter.com/intent/tweet?status=Disabling%20GKE%20load%20balancer%20in%20Kubernetes-http%3a%2f%2fwww.maikel-hofman.nl%2fpost%2fdisabling-gke-loadbalancer-in-kubernetes%2f" target="_blank" title="Follow me on Twitter" class="twitter">
<span class="fa fa-twitter-square fa-3x"></span></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fwww.maikel-hofman.nl%2fpost%2fdisabling-gke-loadbalancer-in-kubernetes%2f" target="_blank" title="Join me on Facebook" class="facebook">
<span class="fa fa-facebook-square fa-3x"></span></a>
<a href="https://plus.google.com/share?url=http%3a%2f%2fwww.maikel-hofman.nl%2fpost%2fdisabling-gke-loadbalancer-in-kubernetes%2f" target="_blank" title="Google+" class="googleplus">
<span class="fa fa-google-plus-square fa-3x"></span></a>
<a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fwww.maikel-hofman.nl%2fpost%2fdisabling-gke-loadbalancer-in-kubernetes%2f&title=Disabling%20GKE%20load%20balancer%20in%20Kubernetes" target="_blank" title="LinkedIn" class="linkedin">
<span class="fa fa-linkedin-square fa-3x"></span></a>
<a href="http://www.reddit.com/submit?url=http%3a%2f%2fwww.maikel-hofman.nl%2fpost%2fdisabling-gke-loadbalancer-in-kubernetes%2f" target="_blank" title="Reddit" class="reddit"><span class="fa fa-reddit-square fa-3x"></span></a>
<a href="http://www.stumbleupon.com/submit?url=http%3a%2f%2fwww.maikel-hofman.nl%2fpost%2fdisabling-gke-loadbalancer-in-kubernetes%2f" target="_blank" title="StumbleUpon" class="stumbleupon"><span class="fa fa-stumbleupon fa-3x">
</span></a>
</div>
        



      </div>
    </div>

  </body>
  
</html>
